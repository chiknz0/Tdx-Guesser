<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google AdSense Verification -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2761094953116204" crossorigin="anonymous"></script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-0PBBF2HHSL"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-0PBBF2HHSL');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TDX Guessr - Tower Guessing Game</title>
    
    <link rel="icon" type="image/png" href="assets/logo.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@700&display=swap');
        
        body {
            font-family: 'Fredoka', sans-serif;
            background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.7)), 
                        url('https://i.postimg.cc/HLxVCWzc/maxresdefault.jpg'),
                        url('assets/background.jpg.jpg'),
                        #121212;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: white;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            overflow-y: auto;
            margin: 0;
            padding: 1rem;
            font-size: 0.75rem;
        }

        .game-wrapper {
            width: 100%;
            max-width: 340px;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            position: relative;
        }

        .glass-box {
            background: rgba(10, 10, 10, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            padding: 0.6rem;
        }

        .mode-btn {
            transition: all 0.2s ease;
            filter: grayscale(100%);
            opacity: 0.5;
            cursor: pointer;
        }

        .mode-btn.active {
            filter: grayscale(0%);
            opacity: 1;
            transform: scale(1.05);
            border-bottom: 2px solid #fbbf24;
        }

        .pixel-container {
            width: 120px;
            height: 120px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
            border-radius: 8px;
            border: 1px solid #333;
        }

        #pixelCanvas {
            width: 120px;
            height: 120px;
            image-rendering: pixelated;
        }

        .stat-square {
            width: 100%;
            aspect-ratio: 1/1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            text-align: center;
            font-size: 0.45rem;
            font-weight: bold;
            padding: 2px;
        }

        .correct { background-color: #16a34a !important; border: 1px solid #22c55e; }
        .incorrect { background-color: #991b1b !important; border: 1px solid #ef4444; }
        
        .suggestion-item:hover { background-color: #1d4ed8; }
        
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #0a0a0a; }
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 10px; }

        .animate-reveal {
            animation: reveal 0.2s ease-out forwards;
        }

        @keyframes reveal {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .share-toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #2563eb;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.7rem;
            z-index: 100;
        }

        .btn-discord {
            background-color: #5865F2;
            color: white;
            transition: background-color 0.2s;
        }
        .btn-discord:hover {
            background-color: #4752c4;
        }
        .btn-donate {
            background-color: #FFDD00;
            color: #000000;
            transition: background-color 0.2s;
        }
        .btn-donate:hover {
            background-color: #e6c700;
        }
    </style>
</head>
<body onclick="startAudio()">

    <!-- Audio Controls -->
    <div class="fixed top-2 left-2 z-50">
        <button onclick="toggleMusic()" class="glass-box !p-0 !w-10 !h-10 flex items-center justify-center hover:bg-gray-800 transition">
            <span id="musicIcon" class="text-lg">üîá</span>
        </button>
    </div>

    <!-- Stats -->
    <div class="fixed top-2 right-2 flex flex-col gap-1.5 z-50">
        <button class="glass-box !p-0 !w-10 !h-10 flex items-center justify-center hover:bg-gray-800 transition">
            <span class="text-xl">üèÜ</span>
        </button>
        <button class="glass-box !p-0 flex flex-col items-center justify-center !w-10 !h-10 hover:bg-gray-800 transition">
            <span class="text-lg">üî•</span>
            <span id="streakCount" class="text-[8px] font-black -mt-1">0</span>
        </button>
    </div>

    <div class="game-wrapper">
        <div class="flex flex-col items-center mb-1">
            <img src="assets/logo.png" 
                 alt="TDX Guessr Logo" 
                 onerror="this.src='https://i.postimg.cc/Sj6mc3GZ/unnamed.png'"
                 class="w-full max-h-24 object-contain">
        </div>

        <!-- Mode Selector -->
        <div class="glass-box">
            <div class="grid grid-cols-4 gap-1.5">
                <button onclick="changeMode('classic')" id="mode-classic" class="mode-btn active flex flex-col items-center">
                    <img src="https://img.icons8.com/color/48/sword.png" class="w-5 h-5 mb-1">
                    <span class="text-[7px] uppercase font-bold">Classic</span>
                </button>
                <button onclick="changeMode('pixel')" id="mode-pixel" class="mode-btn flex flex-col items-center">
                    <img src="https://img.icons8.com/color/48/picture.png" class="w-5 h-5 mb-1">
                    <span class="text-[7px] uppercase font-bold">Pixel</span>
                </button>
                <button onclick="changeMode('emoji')" id="mode-emoji" class="mode-btn flex flex-col items-center">
                    <img src="https://img.icons8.com/color/48/happy.png" class="w-5 h-5 mb-1">
                    <span class="text-[7px] uppercase font-bold">Emoji</span>
                </button>
                <button onclick="changeMode('description')" id="mode-description" class="mode-btn flex flex-col items-center">
                    <img src="https://img.icons8.com/color/48/document.png" class="w-5 h-5 mb-1">
                    <span class="text-[7px] uppercase font-bold">Desc</span>
                </button>
            </div>

            <div class="mt-2 px-1">
                <div class="flex justify-between text-[8px] mb-1 text-gray-400 font-bold">
                    <span>DAILY PROGRESS</span>
                    <span id="progressPercent">0%</span>
                </div>
                <div class="w-full bg-gray-900 h-1 rounded-full overflow-hidden">
                    <div id="progressBar" class="bg-yellow-500 h-full w-0 transition-all duration-500"></div>
                </div>
            </div>
        </div>

        <!-- Game Area -->
        <div class="glass-box flex flex-col items-center">
            <div id="displayArea" class="w-full min-h-[140px] flex flex-col items-center justify-center">
                
                <div id="pixelDisplay" class="hidden text-center">
                    <div class="pixel-container mx-auto shadow-inner">
                        <canvas id="pixelCanvas" width="120" height="120"></canvas>
                    </div>
                    <div class="mt-2">
                        <label class="inline-flex items-center cursor-pointer group">
                            <input type="checkbox" id="hardModeToggle" class="sr-only peer">
                            <div class="relative w-7 h-3.5 bg-gray-700 rounded-full peer peer-checked:bg-orange-600"></div>
                            <span class="ms-2 text-[8px] font-bold text-gray-400 uppercase group-hover:text-white transition">Hard Mode</span>
                        </label>
                    </div>
                </div>

                <div id="emojiDisplay" class="hidden text-center">
                    <div id="emojiSlots" class="flex gap-1.5 text-2xl bg-black/50 p-3 rounded-lg"></div>
                </div>

                <div id="descriptionDisplay" class="hidden text-center p-3 bg-black/40 rounded-lg w-full">
                    <p id="descText" class="text-[10px] italic text-yellow-50"></p>
                </div>

                <div id="classicDisplay" class="text-center p-2">
                    <h3 class="text-lg mb-1 text-yellow-400 uppercase font-black">Unknown Tower</h3>
                    <p class="text-gray-400 text-[9px] uppercase">Submit guesses to see stats</p>
                </div>
            </div>

            <div id="interactionSection" class="w-full relative mt-2">
                <input type="text" id="guessInput" placeholder="Guess a tower..." autocomplete="off"
                       class="w-full bg-black/50 border border-white/10 rounded-lg p-2 text-sm focus:border-yellow-500 outline-none text-white">
                <div id="suggestions" class="absolute bottom-full left-0 w-full glass-box mb-2 max-h-40 overflow-y-auto hidden z-50 !p-1"></div>
            </div>

            <div id="winControls" class="hidden w-full mt-2 flex flex-col gap-1.5">
                <button onclick="resetGame()" class="w-full bg-green-600 hover:bg-green-500 p-2 rounded-lg font-black text-xs">PLAY AGAIN</button>
                <button onclick="shareResults()" class="w-full bg-blue-700 hover:bg-blue-600 p-1.5 rounded-lg font-bold text-[10px] flex items-center justify-center gap-1">
                    SHARE
                </button>
            </div>

            <div id="guessHistory" class="w-full mt-3 space-y-1"></div>
        </div>

        <!-- Support Buttons -->
        <div class="flex gap-1.5 w-full">
            <a href="https://discord.gg/r7JXFmk8Ku" target="_blank" class="btn-discord flex-1 flex items-center justify-center gap-2 py-2 rounded-lg shadow-lg">
                <svg width="14" height="14" viewBox="0 0 127.14 96.36" fill="white"><path d="M107.7,8.07A105.15,105.15,0,0,0,81.47,0a72.06,72.06,0,0,0-3.36,6.83A97.68,97.68,0,0,0,49,6.83,72.37,72.37,0,0,0,45.64,0,105.89,105.89,0,0,0,19.39,8.09C2.71,32.65-1.82,56.6.48,80.21a105.73,105.73,0,0,0,32.22,16.15,77.7,77.7,0,0,0,7.37-12,67.65,67.65,0,0,1-11.9-5.69c.97-.69,1.93-1.39,2.85-2.12a74.22,74.22,0,0,0,65.29,0c.92.73,1.88,1.43,2.85,2.12a67.4,67.4,0,0,1-11.9,5.69,77,77,0,0,0,7.37,12,105.45,105.45,0,0,0,32.27-16.15C130.39,52.3,124.09,28.52,107.7,8.07ZM42.45,65.69C36.18,65.69,31,60,31,53s5.07-12.72,11.45-12.72,11.55,5.74,11.45,12.72S48.72,65.69,42.45,65.69Zm42.24,0C78.41,65.69,73.25,60,73.25,53s5.07-12.72,11.44-12.72,11.55,5.74,11.45,12.72S91,65.69,84.69,65.69Z"/></svg>
                <span class="text-[9px] font-black uppercase">Discord</span>
            </a>
            <a href="https://buymeacoffee.com/tdxguesser" target="_blank" class="btn-donate flex-1 flex items-center justify-center gap-2 py-2 rounded-lg shadow-lg">
                <img src="https://cdn.buymeacoffee.com/buttons/bmc-new-btn-logo.svg" alt="BMC" class="w-3">
                <span class="text-[9px] font-black uppercase">Donate</span>
            </a>
        </div>
    </div>

    <template id="headerTemplate">
        <div id="classicHeader" class="grid grid-cols-5 gap-0.5 mb-1 text-[7px] text-center text-gray-500 font-bold">
            <div>NAME</div>
            <div>RANGE</div>
            <div>RARITY</div>
            <div>TYPE</div>
            <div>LOC</div>
        </div>
    </template>

    <script>
        const towers = [
            { name: "Ranger", range: "Medium", rarity: "Beginner", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/6/61/RangerNew.png", desc: "Starter Tower, Shoots Basic Rifle", emojis: ["üî´", "üå≤", "üéØ", "üö∂"] },
            { name: "Shotgunner", range: "Short", rarity: "Beginner", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/5/56/ShotgunnerBase.png", desc: "Uses a shotgun", emojis: ["üêö", "üî•", "üí®", "üõ°Ô∏è"] },
            { name: "Operator", range: "Medium", rarity: "Beginner", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/6/66/Operator_0.png", desc: "Has a fast gun and can spawn cars", emojis: ["üöó", "‚ö°", "üî´", "üìû"] },
            { name: "Mine Layer", range: "Short", rarity: "Beginner", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/a/a2/Mine_Layer_0.png", desc: "Puts mines on track every so often", emojis: ["üí£", "üõ£Ô∏è", "üë∑", "üí•"] },
            { name: "Sniper", range: "Long", rarity: "Beginner", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/f/f7/Sniper_0.png", desc: "Long Ranger Sniper", emojis: ["üî≠", "üèπ", "üèîÔ∏è", "üéØ"] },
            { name: "Cryo Blaster", range: "Short", rarity: "Beginner", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/7/79/Cryoblaster_0.png", desc: "An ice tower that freezes stuff", emojis: ["‚ùÑÔ∏è", "üßä", "üî´", "ü•∂"] },
            { name: "Missile Trooper", range: "Medium", rarity: "Beginner", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/b/bc/VSMissileTrooper.png", desc: "Shoots rockets", emojis: ["üöÄ", "üí•", "ü™ñ", "üß®"] },
            { name: "Patrol Boat", range: "Short", rarity: "Beginner", type: "Water", loc: "Water", img: "https://static.wikia.nocookie.net/tdx/images/4/46/Patrol_Boat_0.png", desc: "A water unit that shoots (a boat)", emojis: ["üö§", "üåä", "üî´", "‚öì"] },
            { name: "Farm", range: "N/A", rarity: "Intermediate", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/b/bb/Farm_0_IG.png", desc: "Generates money every wave", emojis: ["üí∞", "üåΩ", "üöú", "üí∏"] },
            { name: "Barracks", range: "N/A", rarity: "Beginner", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/c/c1/Barracks_0.png", desc: "Spawns riflemen and flametrooper men", emojis: ["üè¢", "ü™ñ", "üî•", "‚öîÔ∏è"] },
            { name: "Grenadier", range: "Short", rarity: "Beginner", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/6/6c/Grenadier_0.png", desc: "Throws grenades", emojis: ["üí£", "üñêÔ∏è", "üí•", "ü™ñ"] },
            { name: "EDJ", range: "Medium", rarity: "Intermediate", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/e/ed/EDJ_0.png", desc: "Gives discount and firerate buffs to nearby towers", emojis: ["üéß", "üéµ", "üí∞", "‚ö°"] },
            { name: "John", range: "Medium", rarity: "Intermediate", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/1/16/John_0.png", desc: "The creator of TDX. But a tower. With a Glock 19", emojis: ["üßë", "üï∂Ô∏è", "üî´", "üõ†Ô∏è"] },
            { name: "Laser Gunner", range: "Medium", rarity: "Intermediate", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/6/68/Laser_0.png", desc: "Shoots piercing lasers", emojis: ["üî¶", "üåà", "‚ö°", "üëΩ"] },
            { name: "Toxicnator", range: "Medium", rarity: "Intermediate", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/5/51/Toxicnator_0.png", desc: "Poisons enemies", emojis: ["‚ò£Ô∏è", "üß™", "ü§¢", "üíÄ"] },
            { name: "Sentry", range: "Short", rarity: "Beginner", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/a/a1/SentryBase.png", desc: "Has an arc range, a worse version of machine gunner", emojis: ["ü§ñ", "üì°", "üî´", "üõ°Ô∏è"] },
            { name: "Artillery", range: "Long", rarity: "Intermediate", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/3/36/Artillery_0.png", desc: "Controllable mortar", emojis: ["üéØ", "üêö", "üí•", "üì°"] },
            { name: "Jet Trooper", range: "Short", rarity: "Intermediate", type: "Air", loc: "Air", img: "https://static.wikia.nocookie.net/tdx/images/4/45/JetTrooper0.png", desc: "Flying tower, shoots missiles in bursts", emojis: ["üöÄ", "‚òÅÔ∏è", "ü™ñ", "üî•"] },
            { name: "AA-Turret", range: "Long", rarity: "Intermediate", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/d/dc/AATurret0.png", desc: "Can only shoot flying enemies; with missiles", emojis: ["üö´", "‚úàÔ∏è", "üöÄ", "üì°"] },
            { name: "Armored Factory", range: "N/A", rarity: "Intermediate", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/a/a5/Armored_Factory_0.png", desc: "Spawns armored tanks", emojis: ["üè≠", "üöú", "üõ°Ô∏è", "üî•"] },
            { name: "Juggernaut", range: "Medium", rarity: "Intermediate", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/f/f2/Jug_0.png", desc: "A minigun troop", emojis: ["ü¶æ", "üî•", "üî´", "üõ°Ô∏è"] },
            { name: "Ghost", range: "Medium", rarity: "Intermediate", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/0/04/GhostBase.png", desc: "A girl with an Uzi who can stealth herself", emojis: ["üëª", "üèôÔ∏è", "üî´", "üëó"] },
            { name: "Mobster", range: "Medium", rarity: "Intermediate", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/3/3d/MobsterBase.png", desc: "Spawns goons and makes money", emojis: ["üé©", "üï¥Ô∏è", "üí∞", "üî´"] },
            { name: "Rail Gunner", range: "Long", rarity: "Late Game", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/4/42/Railgunner_0.png", desc: "A slow firing laser shooter", emojis: ["‚ö°", "üî¶", "üßä", "üéØ"] },
            { name: "Machine Gunner", range: "Medium", rarity: "Late Game", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/f/fe/MachineGunner0.png", desc: "A gunner with an arc range", emojis: ["üî´", "‚õìÔ∏è", "üî•", "üõ°Ô∏è"] },
            { name: "Medic", range: "Medium", rarity: "Late Game", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/4/44/MedicBase.png", desc: "A troop that can heal nearby towers", emojis: ["üè•", "üíâ", "‚ù§Ô∏è", "ü©π"] },
            { name: "Slammer", range: "Short", rarity: "Late Game", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/6/6f/SlammerBase.png", desc: "A melee tower with a hammer (female)", emojis: ["üî®", "üí•", "üëó", "üß±"] },
            { name: "XWM Turret", range: "Long", rarity: "Late Game", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/a/ad/XWMBase.png", desc: "A turret that can rebuild after death", emojis: ["üë©‚Äçüíª", "ü§ñ", "üîß", "üîã"] },
            { name: "Golden Ranger", range: "Medium", rarity: "Late Game", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/d/db/GoldenRangerBase.png", desc: "A better golden variant of Ranger", emojis: ["‚ú®", "üëë", "üî´", "üí∞"] },
            { name: "Golden Mine Layer", range: "Short", rarity: "Late Game", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/2/29/GoldenMineLayerBase.png", desc: "Better golden variant of normal mine layer", emojis: ["‚ú®", "üëë", "üí£", "üí∞"] },
            { name: "Combat Drone", range: "N/A", rarity: "Late Game", type: "Air", loc: "Air", img: "https://static.wikia.nocookie.net/tdx/images/9/9e/CombatDrone0.png", desc: "A controllable shooter drone", emojis: ["üöÅ", "üïπÔ∏è", "üî´", "üõ∞Ô∏è"] },
            { name: "Warship", range: "V. Long", rarity: "Late Game", type: "Water", loc: "Water", img: "https://static.wikia.nocookie.net/tdx/images/e/ee/Warship_0.png", desc: "A navy ship.", emojis: ["üö¢", "üåä", "‚öì", "üêö"] },
            { name: "Helicopter", range: "V. Long", rarity: "Late Game", type: "Air", loc: "Air", img: "https://static.wikia.nocookie.net/tdx/images/7/7d/HelicopterBase.png", desc: "A flying high DPS heli", emojis: ["üöÅ", "üå™Ô∏è", "üî•", "üî´"] },
            { name: "Golden Juggernaut", range: "Medium", rarity: "Late Game", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/f/f0/GoldenJuggernautBase.png", desc: "A high DPS golden variant of Juggernaut", emojis: ["‚ú®", "üëë", "ü¶æ", "üî•"] },
            { name: "Golden Mobster", range: "Medium", rarity: "Late Game", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/d/dd/GoldenMobster0.png", desc: "Generates Money and spawns goons (better)", emojis: ["‚ú®", "üëë", "üï¥Ô∏è", "üí∞"] },
            { name: "Shield Tower", range: "Medium", rarity: "Intermediate", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/a/a4/ShieldTower0.png", desc: "Protects towers", emojis: ["üõ°Ô∏è", "üîã", "üí°", "üèóÔ∏è"] },
            { name: "Oil Derrick", range: "N/A", rarity: "Intermediate", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/9/91/OilDerrick0.png", desc: "Generates money by pumping oil", emojis: ["üõ¢Ô∏è", "üí∞", "‚öôÔ∏è", "üèóÔ∏è"] },
            { name: "Behemoth Factory", range: "N/A", rarity: "Late Game", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/2/20/BehemothFactory0.png", desc: "Spawns tanks", emojis: ["üè≠", "üêò", "üöú", "üî•"] },
            { name: "Commander", range: "Medium", rarity: "Late Game", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/a/a8/CommanderBase.png", desc: "Buffs damage and firerate of nearby towers", emojis: ["üì£", "‚≠ê", "‚ö°", "ü™ñ"] },
            { name: "War Machine Factory", range: "N/A", rarity: "Late Game", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/e/ea/WarMachineFactory0.png", desc: "Spawns high DPS walker mechs", emojis: ["üè≠", "ü§ñ", "‚öîÔ∏è", "üî•"] },
            { name: "Refractor", range: "Long", rarity: "Late Game", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/c/ca/Refractor0.png", desc: "A high DPS tower that shoots laser ray", emojis: ["üíé", "üî¶", "‚ö°", "üî•"] },
            { name: "Cryo Ranger", range: "Medium", rarity: "Beginner", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/8/81/Cryo_Ranger_0.png", desc: "Like Ranger, but shoots ice", emojis: ["‚ùÑÔ∏è", "üî´", "üå≤", "ü•∂"] },
            { name: "Z.E.D.", range: "N/A", rarity: "Late Game", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/c/cd/ZedBase.png", desc: "Spawns a high-tech armed vehicle", emojis: ["ü§ñ", "üöî", "üî´", "‚ö°"] },
            { name: "Scarecrow", range: "Short", rarity: "Beginner", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/1/19/ScarecrowBase.png", desc: "Baits Boss attacks", emojis: ["üéÉ", "üåæ", "ü§°", "üõ°Ô∏è"] },
            { name: "Flame Trooper", range: "Medium", rarity: "Intermediate", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/2/2d/FlameTrooperBase.png", desc: "Pyromancer, uses a flamethrower", emojis: ["üî•", "üßØ", "ü™ñ", "üåã"] },
            { name: "Relic", range: "N/A", rarity: "Late Game", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/b/ba/RelicBase.png", desc: "Spawns Undead Creatures", emojis: ["üè∫", "üíÄ", "ü™Ñ", "üèúÔ∏è"] },
            { name: "Cryo Helicopter", range: "V. Long", rarity: "Intermediate", type: "Air", loc: "Air", img: "https://static.wikia.nocookie.net/tdx/images/0/00/CryoHelicopter0.png", desc: "Like Helicopter, but shoots ice ray", emojis: ["üöÅ", "‚ùÑÔ∏è", "üßä", "‚òÅÔ∏è"] },
            { name: "Ice Breaker", range: "Short", rarity: "Beginner", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/3/39/IceBreaker0.png", desc: "Freezes enemies with melee", emojis: ["‚õèÔ∏è", "‚ùÑÔ∏è", "üßä", "ü•ã"] },
            { name: "Troll Tower", range: "Short", rarity: "Beginner", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/b/b6/TrollTower0.png", desc: "Meme tower, Baits boss attacks", emojis: ["ü§°", "üé≠", "üõ°Ô∏è", "üòÇ"] },
            { name: "Goo Gunner", range: "Medium", rarity: "Beginner", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/6/6f/GooGunner0.png", desc: "Uses sticky goo to slow down enemies", emojis: ["üß™", "üî´", "ü¶†", "üêå"] },
            { name: "Shock Trooper", range: "Long", rarity: "Late Game", type: "Ground", loc: "Ground", img: "https://static.wikia.nocookie.net/tdx/images/6/6d/ShockTrooper0.png", desc: "Shocks crowds of enemies", emojis: ["‚ö°", "‚òÅÔ∏è", "ü™ñ", "üí•"] }
        ];

        let currentMode = 'classic';
        let targetTower = null;
        let guesses = [];
        let winState = false;
        let pixelScale = 2; 
        let visibleEmojis = 1;
        let dailyProgress = { classic: false, pixel: false, emoji: false, description: false };
        let imgObj = new Image();

        const bgMusic = new Audio('https://www.mboxdrive.com/TDX_Theme.mp3'); 
        bgMusic.loop = true;
        bgMusic.volume = 0.2;
        const clickSound = new Audio('https://www.soundjay.com/buttons/button-16.mp3');
        const winSound = new Audio('https://www.soundjay.com/human/applause-01.mp3');
        
        let audioStarted = false;
        let isMuted = true;

        function getSafeImageUrl(originalUrl) {
            if (!originalUrl) return "https://img.icons8.com/color/96/question-mark.png";
            if (originalUrl.includes('wikia.nocookie.net')) {
                const cleanUrl = originalUrl.split('/revision')[0];
                return `https://images.weserv.nl/?url=${encodeURIComponent(cleanUrl)}`;
            }
            return originalUrl;
        }

        function startAudio() {
            if (!audioStarted) {
                audioStarted = true;
                if (!isMuted) bgMusic.play().catch(() => {});
            }
        }

        function toggleMusic() {
            const icon = document.getElementById('musicIcon');
            isMuted = !isMuted;
            if (isMuted) {
                bgMusic.pause();
                icon.innerText = "üîá";
            } else {
                bgMusic.play().catch(() => {});
                icon.innerText = "üîä";
            }
            playClick();
        }

        function playClick() {
            if (clickSound) {
                clickSound.currentTime = 0;
                clickSound.play().catch(() => {});
            }
        }

        function initGame() {
            const saved = JSON.parse(localStorage.getItem('tdx_daily_v20'));
            if(saved) dailyProgress = saved;
            updateProgressBar();
            
            const input = document.getElementById('guessInput');
            input.addEventListener('input', showSuggestions);
            input.addEventListener('keypress', (e) => { 
                if(e.key === 'Enter') handleGuess(input.value); 
            });
            
            const hardToggle = document.getElementById('hardModeToggle');
            if (hardToggle) {
                hardToggle.addEventListener('change', () => {
                    playClick();
                    updateDisplay();
                });
            }

            changeMode('classic');
        }

        function changeMode(mode) {
            playClick();
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            const modeBtn = document.getElementById('mode-' + mode);
            if (modeBtn) modeBtn.classList.add('active');
            
            ['pixelDisplay', 'emojiDisplay', 'descriptionDisplay', 'classicDisplay'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.classList.add('hidden');
            });
            const activeDisplay = document.getElementById(mode + 'Display');
            if (activeDisplay) activeDisplay.classList.remove('hidden');

            resetGame();
        }

        function resetGame() {
            guesses = [];
            winState = false;
            pixelScale = 2; 
            visibleEmojis = 1;
            targetTower = towers[Math.floor(Math.random() * towers.length)];
            
            document.getElementById('winControls').classList.add('hidden');
            document.getElementById('interactionSection').classList.remove('hidden');
            document.getElementById('guessInput').disabled = false;
            document.getElementById('guessInput').value = '';
            document.getElementById('guessHistory').innerHTML = '';
            
            if (currentMode === 'classic') {
                const template = document.getElementById('headerTemplate');
                document.getElementById('guessHistory').appendChild(template.content.cloneNode(true));
            }
            
            if(currentMode === 'pixel') {
                imgObj = new Image();
                imgObj.crossOrigin = "anonymous";
                imgObj.src = getSafeImageUrl(targetTower.img);
                imgObj.onload = () => updateDisplay();
                imgObj.onerror = () => {
                    imgObj.src = "https://img.icons8.com/color/96/question-mark.png";
                };
            } else {
                updateDisplay();
            }
        }

        function updateDisplay() {
            if(currentMode === 'pixel' && imgObj.complete) {
                const canvas = document.getElementById('pixelCanvas');
                const ctx = canvas.getContext('2d');
                
                // Use a larger canvas size to avoid the "single pixel" center crop
                // Dim is the size of the pixel grid (e.g., 2x2, 4x4, etc)
                const dim = winState ? 120 : pixelScale;
                
                // Create an offscreen buffer to draw the low-res version
                const tempCanvas = document.createElement('canvas');
                tempCanvas.width = dim;
                tempCanvas.height = dim;
                const tempCtx = tempCanvas.getContext('2d');
                
                const hardToggle = document.getElementById('hardModeToggle');
                if(hardToggle && hardToggle.checked && !winState) {
                    tempCtx.filter = 'grayscale(100%) contrast(150%) brightness(80%)';
                }

                // Draw image onto the small canvas, covering the whole area
                tempCtx.drawImage(imgObj, 0, 0, dim, dim);
                
                // Upscale back to the main canvas
                ctx.imageSmoothingEnabled = false;
                ctx.clearRect(0, 0, 120, 120);
                ctx.drawImage(tempCanvas, 0, 0, dim, dim, 0, 0, 120, 120);
            } else if(currentMode === 'emoji') {
                document.getElementById('emojiSlots').innerHTML = targetTower.emojis.map((e, i) => 
                    i < visibleEmojis ? `<span class="animate-reveal">${e}</span>` : `<span class="opacity-10 grayscale">?</span>`
                ).join('');
            } else if(currentMode === 'description') {
                const words = targetTower.desc.split(' ');
                const revealCount = winState ? words.length : Math.max(1, guesses.length);
                document.getElementById('descText').innerHTML = words.map((w, i) => {
                    if (i < revealCount) return w;
                    return '_'.repeat(w.length);
                }).join(' ');
            }
        }

        function handleGuess(guessName) {
            if(winState) return;
            const guess = towers.find(t => t.name.toLowerCase() === guessName.trim().toLowerCase());
            if(!guess) return;

            playClick();
            guesses.push(guess);
            document.getElementById('guessInput').value = '';
            document.getElementById('suggestions').classList.add('hidden');

            if(guess.name === targetTower.name) {
                winGame();
            } else {
                // Double resolution with each wrong guess
                pixelScale = Math.min(120, pixelScale * 2); 
                visibleEmojis = Math.min(4, visibleEmojis + 1);
            }

            addGuessRow(guess);
            updateDisplay();
        }

        function addGuessRow(guess) {
            const container = document.getElementById('guessHistory');
            const row = document.createElement('div');
            
            if(currentMode === 'classic') {
                row.className = "grid grid-cols-5 gap-0.5 animate-reveal";
                row.innerHTML = `
                    <div class="stat-square border border-white/10 bg-black/40 overflow-hidden text-[5px] font-bold uppercase">${guess.name}</div>
                    <div class="stat-square ${guess.range === targetTower.range ? 'correct' : 'incorrect'}">${guess.range}</div>
                    <div class="stat-square ${guess.rarity === targetTower.rarity ? 'correct' : 'incorrect'}">${guess.rarity}</div>
                    <div class="stat-square ${guess.type === targetTower.type ? 'correct' : 'incorrect'}">${guess.type}</div>
                    <div class="stat-square ${guess.loc === targetTower.loc ? 'correct' : 'incorrect'}">${guess.loc}</div>
                `;
                const header = document.getElementById('classicHeader');
                if (header) container.insertBefore(row, header.nextSibling);
                else container.appendChild(row);
            } else {
                const isCorrect = guess.name === targetTower.name;
                row.className = `flex items-center gap-2 glass-box !p-1.5 ${isCorrect ? 'correct' : 'incorrect'} border-2 animate-reveal`;
                row.innerHTML = `<img src="${getSafeImageUrl(guess.img)}" class="w-8 h-8 rounded shadow border border-white/10" onerror="this.src='https://img.icons8.com/color/48/question-mark.png'"> <span class="text-[10px] font-black uppercase tracking-wide">${guess.name}</span>`;
                container.prepend(row);
            }
        }

        function winGame() {
            winState = true;
            if (winSound) winSound.play().catch(() => {});
            document.getElementById('guessInput').disabled = true;
            document.getElementById('interactionSection').classList.add('hidden');
            document.getElementById('winControls').classList.remove('hidden');
            
            dailyProgress[currentMode] = true;
            localStorage.setItem('tdx_daily_v20', JSON.stringify(dailyProgress));
            updateProgressBar();
            updateDisplay();
        }

        function shareResults() {
            const text = `TDX Guessr: ${guesses.length} attempts! ‚úÖ\nMode: ${currentMode.toUpperCase()}`;
            navigator.clipboard.writeText(text).then(() => {
                const toast = document.createElement('div');
                toast.className = 'share-toast';
                toast.innerText = 'Copied to clipboard!';
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 2000);
            });
        }

        function updateProgressBar() {
            const won = Object.values(dailyProgress).filter(v => v).length;
            const percent = (won / 4) * 100;
            const bar = document.getElementById('progressBar');
            const label = document.getElementById('progressPercent');
            if (bar) bar.style.width = percent + '%';
            if (label) label.innerText = Math.round(percent) + '%';
        }

        function showSuggestions(e) {
            const val = e.target.value.toLowerCase();
            const suggCont = document.getElementById('suggestions');
            if(!val) { suggCont.classList.add('hidden'); return; }
            const matches = towers.filter(t => t.name.toLowerCase().includes(val));
            if(matches.length > 0) {
                suggCont.innerHTML = matches.map(m => `
                    <div class="suggestion-item p-1.5 cursor-pointer flex items-center gap-2" onclick="handleGuess('${m.name}')">
                        <img src="${getSafeImageUrl(m.img)}" class="w-5 h-5 rounded" onerror="this.src='https://img.icons8.com/color/48/question-mark.png'">
                        <span class="text-[8px] font-bold uppercase">${m.name}</span>
                    </div>`).join('');
                suggCont.classList.remove('hidden');
            } else suggCont.classList.add('hidden');
        }

        window.onload = initGame;
    </script>
</body>
</html>
